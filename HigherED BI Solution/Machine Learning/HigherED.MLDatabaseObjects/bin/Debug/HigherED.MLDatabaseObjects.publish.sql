/*
Deployment script for HigherED_DW

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "HigherED_DW"
:setvar DefaultFilePrefix "HigherED_DW"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
PRINT N'Creating [MLInput]...';


GO
CREATE SCHEMA [MLInput]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [MLOutput]...';


GO
CREATE SCHEMA [MLOutput]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [MLOutput].[StudentDropClass]...';


GO
CREATE TABLE [MLOutput].[StudentDropClass] (
    [StudentID]          INT          NOT NULL,
    [TermID]             INT          NOT NULL,
    [SubjectID]          VARCHAR (10) NOT NULL,
    [CatalogID]          VARCHAR (10) NOT NULL,
    [ClassID]            INT          NOT NULL,
    [SectionID]          VARCHAR (5)  NOT NULL,
    [EnrollDate]         INT          NOT NULL,
    [DropoutFlag]        INT          NOT NULL,
    [DropoutProbability] FLOAT (53)   NOT NULL,
    [RiskCategory]       VARCHAR (16) NOT NULL,
    [AzureMLTimestamp]   DATETIME     NULL
);


GO
PRINT N'Creating [MLOutput].[StudentFinalGradeEstimate]...';


GO
CREATE TABLE [MLOutput].[StudentFinalGradeEstimate] (
    [StudentID]              INT          NOT NULL,
    [TermID]                 INT          NOT NULL,
    [SubjectID]              VARCHAR (10) NOT NULL,
    [CatalogID]              VARCHAR (10) NOT NULL,
    [ClassID]                INT          NOT NULL,
    [SectionID]              VARCHAR (5)  NOT NULL,
    [FinalGradeEstimate]     VARCHAR (1)  NOT NULL,
    [ProbabilityFinalGradeA] FLOAT (53)   NOT NULL,
    [ProbabilityFinalGradeB] FLOAT (53)   NOT NULL,
    [ProbabilityFinalGradeC] FLOAT (53)   NOT NULL,
    [ProbabilityFinalGradeD] FLOAT (53)   NOT NULL,
    [ProbabilityFinalGradeF] FLOAT (53)   NOT NULL,
    [AzureMLTimestamp]       DATETIME     NULL
);


GO
PRINT N'Creating [MLOutput].[StudentClusters]...';


GO
CREATE TABLE [MLOutput].[StudentClusters] (
    [StudentID]        INT      NOT NULL,
    [TermID]           INT      NOT NULL,
    [ResidencyID]      INT      NOT NULL,
    [AcademicLevelID]  INT      NOT NULL,
    [ClusterID]        INT      NOT NULL,
    [AzureMLTimestamp] DATETIME NULL
);


GO
PRINT N'Creating unnamed constraint on [MLOutput].[StudentDropClass]...';


GO
ALTER TABLE [MLOutput].[StudentDropClass]
    ADD DEFAULT GETDATE() FOR [AzureMLTimestamp];


GO
PRINT N'Creating unnamed constraint on [MLOutput].[StudentFinalGradeEstimate]...';


GO
ALTER TABLE [MLOutput].[StudentFinalGradeEstimate]
    ADD DEFAULT GETDATE() FOR [AzureMLTimestamp];


GO
PRINT N'Creating unnamed constraint on [MLOutput].[StudentClusters]...';


GO
ALTER TABLE [MLOutput].[StudentClusters]
    ADD DEFAULT GETDATE() FOR [AzureMLTimestamp];


GO
PRINT N'Update complete.';


GO
